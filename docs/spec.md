# Diorama Weather - ä»•æ§˜æ›¸

## æ¦‚è¦

Nano Banana Pro ã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚¢ã‚¤ã‚½ãƒ¡ãƒˆãƒªãƒƒã‚¯ãƒ»ãƒŸãƒ‹ãƒãƒ¥ã‚¢3Déƒ½å¸‚æ™¯è¦³ã‚’ä½¿ç”¨ã—ãŸå¤©æ°—ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚¢ãƒ—ãƒªã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨åœ°ã®å¤©æ°—ã‚’ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒªãƒƒãƒã«è¡¨ç¤ºã™ã‚‹ã€‚

| é …ç›® | å†…å®¹ |
|------|------|
| ã‚¢ãƒ—ãƒªå | Diorama Weather |
| ãƒªãƒã‚¸ãƒˆãƒª | `diorama-weather` |
| ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  | Android |
| å½¢å¼ | ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ (4x2) |
| ç”»åƒæ–¹å¼ | ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼ˆãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° + ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼‰ |

---

## æ©Ÿèƒ½è¦ä»¶

### ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¡¨ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         [éƒ½å¸‚å]               â”‚  â† Roboto Bold, å‹•çš„ã‚«ãƒ©ãƒ¼
â”‚           ğŸŒ¤ï¸                   â”‚  â† å¤©æ°—ã‚¢ã‚¤ã‚³ãƒ³
â”‚        12æœˆ4æ—¥                 â”‚  â† Roboto Regular, å°
â”‚          18Â°                   â”‚  â† Roboto Medium, ä¸­
â”‚                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                      â”‚    â”‚
â”‚   â”‚   [AIç”Ÿæˆç”»åƒ]        â”‚    â”‚
â”‚   â”‚   æ±ç”¨éƒ½å¸‚Ã—å¤©æ°—Ã—æ™‚é–“å¸¯  â”‚    â”‚
â”‚   â”‚                      â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¡¨ç¤ºè¦ç´ 

| è¦ç´  | ãƒ•ã‚©ãƒ³ãƒˆ | ã‚µã‚¤ã‚º | é…ç½® |
|------|----------|--------|------|
| éƒ½å¸‚å | Roboto Bold | å¤§ | ä¸Šéƒ¨ä¸­å¤® |
| å¤©æ°—ã‚¢ã‚¤ã‚³ãƒ³ | ã‚·ã‚¹ãƒ†ãƒ çµµæ–‡å­— | ä¸­ | éƒ½å¸‚åä¸‹ |
| æ—¥ä»˜ | Roboto Regular | å° | ã‚¢ã‚¤ã‚³ãƒ³ä¸‹ |
| æ°—æ¸© | Roboto Medium | ä¸­ | æ—¥ä»˜ä¸‹ |

### ãƒ†ã‚­ã‚¹ãƒˆã‚«ãƒ©ãƒ¼ï¼ˆå‹•çš„ï¼‰

| æ¡ä»¶ | ãƒ†ã‚­ã‚¹ãƒˆè‰² | ã‚·ãƒ£ãƒ‰ã‚¦ |
|------|------------|----------|
| æœ / æ™´ã‚Œç³» | `#333333` | ç™½ã‚·ãƒ£ãƒ‰ã‚¦ |
| æ˜¼ / æ™´ã‚Œç³» | `#FFFFFF` | é»’ã‚·ãƒ£ãƒ‰ã‚¦ |
| å¤•æ–¹ | `#FFFFFF` | é»’ã‚·ãƒ£ãƒ‰ã‚¦ |
| å¤œ | `#FFFFFF` | é»’ã‚·ãƒ£ãƒ‰ã‚¦ |
| æ›‡ã‚Š / é›¨ç³» | `#FFFFFF` | é»’ã‚·ãƒ£ãƒ‰ã‚¦ |

---

## ç”»åƒãƒ‘ã‚¿ãƒ¼ãƒ³

### æ™‚é–“å¸¯ Ã— å¤©æ°— = 40ãƒ‘ã‚¿ãƒ¼ãƒ³

**æ™‚é–“å¸¯ï¼ˆ4ç¨®ï¼‰**

| ID | åå‰ | æ™‚é–“ç¯„å›² |
|----|------|----------|
| `morning` | æœ | 6:00 - 11:59 |
| `afternoon` | æ˜¼ | 12:00 - 16:59 |
| `evening` | å¤•æ–¹ | 17:00 - 19:59 |
| `night` | å¤œ | 20:00 - 5:59 |

**å¤©æ°—ï¼ˆ10ç¨®ï¼‰**

| ID | åå‰ | çµµæ–‡å­— |
|----|------|--------|
| `clear` | å¿«æ™´ | â˜€ï¸ |
| `sunny` | æ™´ã‚Œ | ğŸŒ¤ï¸ |
| `cloudy` | æ›‡ã‚Š | â˜ï¸ |
| `fog` | éœ§ | ğŸŒ«ï¸ |
| `light_rain` | å°é›¨ | ğŸŒ§ï¸ |
| `rain` | é›¨ | ğŸŒ§ï¸ |
| `thunderstorm` | é›·é›¨ | â›ˆï¸ |
| `snow` | é›ª | ğŸŒ¨ï¸ |
| `blizzard` | å¹é›ª | â„ï¸ |
| `sleet` | ã¿ãã‚Œ | ğŸŒ¨ï¸ |

### ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«å‘½åè¦å‰‡

```
{time_of_day}_{weather}.png

ä¾‹:
morning_clear.png
afternoon_rain.png
evening_thunderstorm.png
night_snow.png
```

---

## ç”»åƒç”Ÿæˆ

### ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«

| ãƒ¢ãƒ‡ãƒ« | ç”¨é€” |
|--------|------|
| `gemini-2.5-flash-image` | 40ãƒ‘ã‚¿ãƒ¼ãƒ³ã®äº‹å‰ç”Ÿæˆ |

### ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰

```
Present a clear, 45Â° top-down isometric miniature 3D cartoon 
scene of a generic modern city, featuring stylized buildings 
and urban elements (NO specific landmarks). 

Use soft, refined textures with realistic PBR materials and 
gentle, lifelike lighting and shadows for [TIME_OF_DAY] time.

Integrate [WEATHER] conditions directly into the city 
environment to create an immersive atmospheric mood. 

Use a clean, minimalistic composition with a soft, 
solid-colored background.

Leave the top-center area clean for text overlay 
(city name, weather icon, date, temperature).
```

### ç”»åƒä»•æ§˜

| é …ç›® | å€¤ |
|------|-----|
| ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯” | 16:9 |
| è§£åƒåº¦ | 1K |
| å½¢å¼ | PNG |
| å†ç”Ÿæˆé »åº¦ | æœˆ1å› |

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### Android ã‚¢ãƒ—ãƒª

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | æŠ€è¡“ |
|----------------|------|
| è¨€èª | Kotlin |
| UI Framework | Jetpack Compose |
| Widget | Jetpack Glance |
| ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ | Retrofit + OkHttp |
| ç”»åƒèª­ã¿è¾¼ã¿ | Coil |
| ä½ç½®æƒ…å ± | Google Play Services Location |
| ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç† | WorkManager |
| ãƒ‡ãƒ¼ã‚¿ä¿å­˜ | DataStore |
| Minimum SDK | API 26 (Android 8.0) |

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | æŠ€è¡“ |
|----------------|------|
| API ã‚µãƒ¼ãƒãƒ¼ | Cloudflare Workers |
| ç”»åƒã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | Cloudflare R2 |
| Weather API | OpenWeatherMap (Free tier) |
| ç”»åƒç”Ÿæˆ | Gemini API |

---

## API è¨­è¨ˆ

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### GET `/api/weather`

ç¾åœ¨åœ°ã®å¤©æ°—æƒ…å ±ã¨ç”»åƒURLã‚’å–å¾—

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**

```
GET /api/weather?lat={latitude}&lon={longitude}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
{
  "city": "Tokyo",
  "temperature": 18,
  "weather": "sunny",
  "time_of_day": "afternoon",
  "date": "2024-12-04",
  "image_url": "https://r2.example.com/afternoon_sunny.png",
  "icon": "ğŸŒ¤ï¸",
  "text_color": "#FFFFFF",
  "shadow_color": "#000000"
}
```

#### GET `/api/images/{time_of_day}_{weather}.png`

ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ¸ˆã¿ç”»åƒã‚’å–å¾—ï¼ˆR2ã‹ã‚‰é…ä¿¡ï¼‰

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

### Android

```
app/src/main/
â”œâ”€â”€ java/com/example/dioramaweather/
â”‚   â”œâ”€â”€ MainActivity.kt
â”‚   â”œâ”€â”€ DioramaWeatherApp.kt
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ WeatherApi.kt
â”‚   â”‚   â”‚   â””â”€â”€ WeatherApiService.kt
â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”‚   â”œâ”€â”€ WeatherData.kt
â”‚   â”‚   â”‚   â””â”€â”€ WeatherResponse.kt
â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚       â””â”€â”€ WeatherRepository.kt
â”‚   â”œâ”€â”€ widget/
â”‚   â”‚   â”œâ”€â”€ WeatherWidget.kt
â”‚   â”‚   â”œâ”€â”€ WeatherWidgetReceiver.kt
â”‚   â”‚   â””â”€â”€ WeatherWidgetWorker.kt
â”‚   â”œâ”€â”€ location/
â”‚   â”‚   â””â”€â”€ LocationService.kt
â”‚   â””â”€â”€ ui/
â”‚       â”œâ”€â”€ theme/
â”‚       â”‚   â””â”€â”€ Theme.kt
â”‚       â””â”€â”€ settings/
â”‚           â””â”€â”€ SettingsScreen.kt
â”œâ”€â”€ res/
â”‚   â”œâ”€â”€ xml/
â”‚   â”‚   â””â”€â”€ weather_widget_info.xml
â”‚   â”œâ”€â”€ drawable/
â”‚   â”‚   â””â”€â”€ widget_preview.png
â”‚   â””â”€â”€ values/
â”‚       â””â”€â”€ strings.xml
â””â”€â”€ AndroidManifest.xml
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ weather.ts
â”‚   â””â”€â”€ utils.ts
â”œâ”€â”€ wrangler.toml
â””â”€â”€ package.json
```

---

## æ›´æ–°é »åº¦

| é …ç›® | é »åº¦ |
|------|------|
| å¤©æ°—ãƒ‡ãƒ¼ã‚¿å–å¾— | 30åˆ†ã”ã¨ |
| ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¡¨ç¤ºæ›´æ–° | 30åˆ†ã”ã¨ |
| ç”»åƒå†ç”Ÿæˆ | æœˆ1å› |

---

## OpenWeatherMap å¤©æ°—ã‚³ãƒ¼ãƒ‰ ãƒãƒƒãƒ”ãƒ³ã‚°

```kotlin
fun mapWeatherCode(code: Int): String {
    return when (code) {
        in 200..232 -> "thunderstorm"
        in 300..321 -> "light_rain"
        in 500..504 -> "rain"
        511 -> "sleet"
        in 520..531 -> "rain"
        in 600..602 -> "snow"
        in 611..616 -> "sleet"
        in 620..622 -> "snow"
        in 615..616 -> "blizzard"
        in 701..741 -> "fog"
        in 751..781 -> "fog"
        800 -> "clear"
        801 -> "sunny"
        in 802..804 -> "cloudy"
        else -> "cloudy"
    }
}
```

---

## æ¨©é™

### Android

| æ¨©é™ | ç”¨é€” |
|------|------|
| `INTERNET` | APIé€šä¿¡ |
| `ACCESS_FINE_LOCATION` | ç¾åœ¨åœ°å–å¾—ï¼ˆç²¾å¯†ï¼‰ |
| `ACCESS_COARSE_LOCATION` | ç¾åœ¨åœ°å–å¾—ï¼ˆç²—ã„ï¼‰ |
| `ACCESS_BACKGROUND_LOCATION` | ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã®ä½ç½®æ›´æ–° |

---

## å°†æ¥ã®æ‹¡å¼µ

- [ ] iOS ç‰ˆ (WidgetKit)
- [ ] è¤‡æ•°éƒ½å¸‚å¯¾å¿œ
- [ ] ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚µã‚¤ã‚ºãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ (2x2, 4x4)
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç”»åƒç”Ÿæˆã‚ªãƒ—ã‚·ãƒ§ãƒ³
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒ
- [ ] å¤©æ°—äºˆå ±ï¼ˆ5æ—¥é–“ï¼‰è¡¨ç¤º

---

## å‚è€ƒãƒªãƒ³ã‚¯

- [Gemini API Image Generation](https://ai.google.dev/gemini-api/docs/image-generation)
- [Jetpack Glance](https://developer.android.com/jetpack/compose/glance)
- [OpenWeatherMap API](https://openweathermap.org/api)
- [Cloudflare Workers](https://developers.cloudflare.com/workers/)
- [Cloudflare R2](https://developers.cloudflare.com/r2/)
